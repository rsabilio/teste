{GLB.janela_ativa=null;class_janela.instancias=new Array();class_seletor.instancias=new Array();class_hierarquia.instancias=new Array();class_calendario.instancias=new Array();class_popup.instancias=new Array();}function foco_janela(j){if(GLB.janela_ativa){GLB.janela_ativa.style.zIndex=GLB.janela_ativa.zIndex_original;}GLB.janela_ativa=j;GLB.janela_ativa.zIndex_original=GLB.janela_ativa.style.zIndex;GLB.janela_ativa.style.zIndex=1000;}function class_janela(id){var that=this;this.id_janela=id;this.id=class_janela.instancias.length;class_janela.instancias[this.id]=this;this.caixa=null;this.titulo=null;this.pai=null;this.visivel=false;this.abrir=function(pai){if(that.visivel){return;}if(pai==undefined){var b=document.getElementsByTagName("body");if(b.length){pai=b.item(0);}}that.pai=pai;that.pai.appendChild(that.caixa);that.visivel=true;foco_janela(that.caixa);};this.fechar=function(){if(!that.visivel){return;}that.pai.removeChild(that.caixa);that.visivel=false;if(that.simp_onclose){that.simp_onclose();}};this.set_titulo=function(texto_titulo){var divs=that.titulo.getElementsByTagName("div");var l=divs.length;for(var i=0;i<l;i++){var div=divs.item(i);if(get_classe(div)=="texto"){limpar(div);div.appendChild(document.createTextNode(texto_titulo));return;}}};this.criar_janela=function(texto_titulo,x,y,w,h){var id=(that.id_janela)?that.id_janela:'janela'+that.id;x=Math.max(0,parseInt(x));y=Math.max(0,parseInt(y));w=Math.abs(parseInt(w));h=Math.abs(parseInt(h));that.caixa=criar_elemento("div",{"class":"caixa","id":id});if(x){that.caixa.style.left=x+"px";}if(y){that.caixa.style.top=y+"px";}if(w){that.caixa.style.width=w+"px";}if(h){that.caixa.style.height=h+"px";}{that.titulo=criar_elemento("h2",{"class":"titulo"});{var div_texto=criar_elemento("div",{"class":"texto"},{},texto_titulo);var div_botoes=criar_elemento("div",{"class":"botoes"});{that.bt_fechar=criar_elemento("a",{"class":"bt_fechar"},{},"fechar");div_botoes.appendChild(that.bt_fechar);}that.titulo.appendChild(div_texto);that.titulo.appendChild(div_botoes);var div_clear=criar_elemento("div",{},{"clear":"both"});that.titulo.appendChild(div_clear);}}that.caixa.appendChild(that.titulo);that.caixa.onmousedown=function(){foco_janela(that.caixa);};that.bt_fechar.onmousedown=function(){that.bt_fechar.style.borderStyle="inset";};that.bt_fechar.onmouseup=function(){that.bt_fechar.style.borderStyle="outset";};that.bt_fechar.onclick=that.fechar;objeto_movel(that.titulo,that.caixa);return that.caixa;};}function class_seletor(link){var that=this;this.id=class_seletor.instancias.length;class_seletor.instancias[this.id]=this;this.link=link;this.url=link.getAttribute("href");this.input=link.parentNode.getElementsByTagName("input").item(0);this.ultima_busca="";this.seletor=null;this.timer_filtro=null;this.ajax=new class_ajax();this.mudar_item=function(e){var k=e?(e.keyCode?e.keyCode:e.which):window.event.keyCode;switch(k){case 13:var select=that.seletor.itens.firstChild;if(select.selectedIndex>=0){var item=select.options[select.selectedIndex];that.input.value=item.codigo;that.seletor.janela.fechar();try{that.input.focus();that.input.select();}catch(e){}}else{var r=window.confirm("Nenhum item selecionado.\nVocê deseja limpar o campo de busca e procurar algum?");if(r){that.seletor.input_busca.value="";filtrar_seletor(that.id);that.marcar(true);}}return false;case 38:var select=that.seletor.itens.firstChild;if(select.selectedIndex>=0){var item_selecionado=select.options[select.selectedIndex];item=item_selecionado.previousSibling;while(item){if(item.visivel){item_selecionado.selected=false;item.selected=true;return false;}item=item.previousSibling;}}return false;case 40:var select=that.seletor.itens.firstChild;if(select.selectedIndex>=0){var item_selecionado=select.options[select.selectedIndex];item=item_selecionado.nextSibling;while(item){if(item.visivel){item_selecionado.selected=false;item.selected=true;return false;}item=item.nextSibling;}}else{var l=select.options.length;for(var i=0;i<l;i++){var item=select.options[i];if(item.visivel){item.selected=true;return false;}}}return false;case 27:that.seletor.janela.fechar();try{that.input.focus();that.input.select();}catch(e){}return false;default:that.ativar_timer_filtro();break;}return true;};this.atualizar_itens=function(ajax){limpar(that.seletor.itens);var select=criar_elemento("select",{"size":"15"});select.onkeydown=that.mudar_item;var xml=ajax.get_retorno("xml");var entidades=xml.documentElement.getElementsByTagName("entidade");var l=entidades.length;for(var i=0;i<l;i++){var entidade=entidades.item(i);var codigo=entidade.getElementsByTagName("codigo").item(0).firstChild.nodeValue;var valor=entidade.getElementsByTagName("valor").item(0).firstChild.nodeValue;var texto_exibido=codigo+": "+valor;var linha=criar_elemento("option",{"title":valor},{},texto_exibido);linha.pos=i;linha.visivel=true;linha.codigo=codigo;linha.valor=valor;linha.texto_exibido=texto_exibido.toLowerCase();linha.ondblclick=function(){that.input.value=this.codigo;that.seletor.janela.fechar();try{that.input.focus();that.input.select();}catch(e){}};select.appendChild(linha);}that.seletor.itens.appendChild(select);that.seletor.input_busca.disabled=false;try{that.seletor.input_busca.focus();that.seletor.input_busca.select();}catch(e){}filtrar_seletor(that.id);};this.ativar_timer_filtro=function(){if(that.timer_filtro){cancelar_timer(that.timer_filtro);}that.timer_filtro=ativar_timer("filtrar_seletor('"+that.id+"')",1000);};this.criar_caixa=function(pos){var janela=new class_janela();var caixa=janela.criar_janela("Selecione um item",pos.x-230,pos.y-150);{var busca=criar_elemento("div",{"class":"busca"});busca.link=link;{var id="busca_seletor_"+that.id;var label_busca=criar_elemento("label",{"id":id,"for":id},{},"Busca");var input_busca=criar_elemento("input",{"type":"text","maxlength":"40","disabled":"disabled","class":"input_busca","id":id});input_busca.onkeydown=that.mudar_item;var atualizar=criar_elemento("img",{"class":"bt_atualizar","alt":"Atualizar Lista","src":CFG.wwwroot+"imgs/icones/atualizar.gif"});atualizar.pode=3;atualizar.onclick=function(){if(that.seletor.input_busca.disabled){window.alert("Aguarde o carregamento dos dados.");return false;}this.pode--;if(this.pode>0){that.seletor.input_busca.disabled=true;that.carregar_itens();}else{window.alert("Atenção: você clicou em atualizar 3 vezes.\nEsta operação consome recursos e deve ser utilizada com moderação.");this.parentNode.removeChild(this);}return true;}}busca.appendChild(label_busca);busca.appendChild(input_busca);busca.appendChild(atualizar);var itens=criar_elemento("div",{"class":"itens"});}caixa.appendChild(busca);caixa.appendChild(itens);that.seletor={janela:janela,itens:itens,input_busca:input_busca};};this.carregar_itens=function(){that.ajax.set_callback([that,"atualizar_itens"]);that.ajax.exibir_carregando(that.seletor.itens);that.ajax.consultar("GET",that.url,true,null);};this.link.onclick=function abrir_seletor(e){e=e?e:window.event;e.returnValue=false;if(!that.ajax.xmlhttp){var l=adicionar_param(that.url,"input",that.input.id);window.open(l,"Busca","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, width=500, height=400");return false;}if(that.seletor==null){var pos=get_posicao_mouse(e);that.criar_caixa(pos);that.carregar_itens();}that.seletor.janela.abrir(document.getElementsByTagName("body").item(0));try{that.seletor.input_busca.focus();that.seletor.input_busca.select();}catch(e){}return false;};}function filtrar_seletor(id_obj_filtro){try{var obj_filtro=class_seletor.instancias[id_obj_filtro];}catch(e){return false;}var busca=obj_filtro.seletor.input_busca.value.toLowerCase();if(busca==obj_filtro.ultima_busca){return false;}obj_filtro.ultima_busca=busca;obj_filtro.seletor.input_busca.disabled=true;var select=obj_filtro.seletor.itens.firstChild;if(busca.length==0){obj_filtro.seletor.itens.style.display="none";for(var i=select.options.length-1;i>=0;i--){var item=select.options[i];if(!item.visivel){item.visivel=true;item.style.display="block";}}if(select.selectedIndex>=0){select.options[select.selectedIndex].selected=false;}if(select.options.length>0){select.options[0].selected=true;}obj_filtro.seletor.itens.style.display="block";obj_filtro.seletor.input_busca.disabled=false;return false;}var pos=0;obj_filtro.seletor.itens.style.display="none";for(var i=select.options.length-1;i>=0;i--){var item=select.options[i];pos=item.texto_exibido.indexOf(busca);if(pos<0){item.visivel=false;item.style.display="none";}else{item.visivel=true;item.style.display="block";}}if(select.selectedIndex>=0){select.options[select.selectedIndex].selected=false;var l=select.options.length;for(var i=0;i<l;i++){var item=select.options[i];if(item.visivel){item.selected=true;break;}}}obj_filtro.seletor.itens.style.display="block";obj_filtro.seletor.input_busca.disabled=false;}function class_hierarquia(link){var that=this;this.id=class_hierarquia.instancias.length;class_hierarquia.instancias[this.id]=this;this.nivel=0;that.ul=null;that.pai=null;this.link=link;this.url=link.getAttribute("href");this.ws=CFG.wwwroot+"webservice/hierarquia.xml.php";this.input=link.parentNode.getElementsByTagName("input").item(0);this.seletor=null;this.ajax=new class_ajax();this.set_status=function(texto){var t=document.createTextNode(texto);limpar(that.seletor.status);that.seletor.status.appendChild(t);};this.set_botao=function(botao,tipo){switch(tipo){case "+":botao.setAttribute("src",CFG.wwwroot+"imgs/icones/mais.gif");botao.setAttribute("alt","+");botao.setAttribute("title","Abrir Grupo");break;case "-":botao.setAttribute("src",CFG.wwwroot+"imgs/icones/menos.gif");botao.setAttribute("alt","-");botao.setAttribute("title","Fechar Grupo");break;}};this.atualizar_itens=function(ajax){var xml=ajax.get_retorno("xml");var itens=xml.documentElement.getElementsByTagName("item");var ul=criar_elemento("ul",{"class":"hierarquia"});var l=itens.length;for(var i=0;i<l;i++){var item=itens.item(i);var nome=item.getAttribute("nome");var valor=item.getAttribute("valor");var eh_grupo=parseInt(item.getAttribute("eh_grupo"));var linha=criar_elemento("li");linha.nome=nome;linha.valor=valor;linha.nivel=that.nivel;linha.posicao=i;{var linha_lb=criar_elemento("span",{"class":"lb"},{}," ");var linha_l=criar_elemento("span");if(i<(itens.length-1)){definir_classe(linha_l,"l");}{var linha_valor=criar_elemento("span",{"class":"valor"});linha_l.appendChild(linha_valor);}linha.appendChild(linha_lb);linha.appendChild(linha_l);}{if(eh_grupo==1){var botao=criar_elemento("img",{"class":"bt_expandir"});botao.linha=linha;botao.linha_valor=linha_valor;that.set_botao(botao,"+");botao.onmouseover=function(){if(this.getAttribute("alt")=="+"){that.set_status("Clique para abrir o Grupo");}else{that.set_status("Clique para fechar o Grupo");}};botao.onmouseout=function(){that.set_status("");};botao.onclick=function(){var ul=this.nextSibling;while(ul&&ul.nodeName.toLowerCase()!="ul"){ul=ul.nextSibling;}if(ul){ul.style.display=(ul.style.display=="none")?"block":"none";that.set_botao(this,(ul.style.display=="none")?"+":"-");}else{that.pai=this.linha_valor;that.nivel+=1;var url=adicionar_param(that.ws,'link',that.url);var l=this.linha;while(l.nivel>=0){url=adicionar_param(url,"a["+l.nivel+"]",l.posicao);l=l.parentNode.parentNode.parentNode.parentNode;}that.set_status("Carregando...");that.ajax.set_callback([that,"atualizar_itens"]);that.ajax.consultar("GET",url,true,null);that.set_botao(this,"-");}this.onmouseover();};linha_valor.appendChild(botao);}if(valor){var link=criar_elemento("a",{"title":"Selecionar"});link.linha=linha;var texto=document.createTextNode(valor+": "+nome);link.onmouseover=function(){that.set_status("Clique para selecionar o item");};link.onmouseout=function(){that.set_status("");};link.onclick=function(){that.input.value=this.linha.valor;that.seletor.janela.fechar();try{that.input.focus();that.input.select();}catch(e){}};link.appendChild(texto);linha_valor.appendChild(link);}else{var strong=criar_elemento("strong",{},{},nome);strong.linha=linha;linha_valor.appendChild(strong);}}ul.appendChild(linha);}if(itens.length){that.pai.appendChild(ul);}that.set_status("Itens carregados");};this.carregar_itens=function(){var url=adicionar_param(that.ws,"link",that.url);that.pai=that.seletor.itens;that.nivel=0;that.ajax.set_callback([that,"atualizar_itens"]);that.ajax.exibir_carregando(that.seletor.itens);that.ajax.consultar("GET",url,true,null);};this.criar_caixa=function(pos){var janela=new class_janela();var caixa=janela.criar_janela("Selecione um item",pos.x-200,pos.y-100,400);{var itens=criar_elemento("div",{"class":"itens_hierarquico"});var status=criar_elemento("div",{"class":"status"});}caixa.appendChild(itens);caixa.appendChild(status);that.seletor={janela:janela,itens:itens,status:status};};this.link.onclick=function abrir_seletor(e){e=e?e:window.event;e.returnValue=false;if(!that.ajax.xmlhttp){var l=that.ws;l=adicionar_param(l,"link",that.url);l=adicionar_param(l,"input",that.input.id);window.open(l,"Busca","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, width=500, height=400");return false;}if(that.seletor==null){var pos=get_posicao_mouse(e);that.criar_caixa(pos);that.carregar_itens();}that.seletor.janela.abrir(document.getElementsByTagName("body").item(0));return false;};}function class_calendario(div){var that=this;this.id=class_calendario.instancias.length;class_calendario.instancias[this.id]=this;this.div_form=div;this.seletor={janela:null,area_calendario:null};this.link=null;this.mes=0;this.ano=0;this.min_ano=0;this.max_ano=0;this.pode_vazio=false;this.get=function(item){switch(item){case 0:case 1:return that.div_form.getElementsByTagName("select").item(item).value;case 2:var elementos=that.div_form.getElementsByTagName("select");if(elementos.length==3){return elementos.item(2).value;}return that.div_form.getElementsByTagName("input").item(0).value;}return false;};this.get_min_ano=function(){var elementos=that.div_form.getElementsByTagName("select");if(elementos.length!=3){return 0;}var options=elementos.item(2).getElementsByTagName("option");if(that.pode_vazio){return options.item(1).value;}return options.item(0).value;};this.get_max_ano=function(){var elementos=that.div_form.getElementsByTagName("select");if(elementos.length!=3){var hoje=new Date();return hoje.getFullYear()+500;}var options=elementos.item(2).getElementsByTagName("option");return options.item(options.length-1).value;};this.definir_dia=function(td,dia){td.style.cursor="pointer";td.onmouseover=function(){this.style.outline="1px outset #FFFFFF";this.style.backgroundColor="#FFFFFF";};td.onmouseout=function(){this.style.outline="none";this.style.backgroundColor="transparent";};td.onclick=function(){this.style.outline="none";this.style.backgroundColor="transparent";var elementos=that.div_form.getElementsByTagName("select");elementos.item(0).value=dia;if(elementos.item(0).onchange){elementos.item(0).onchange();}elementos.item(1).value=that.mes+1;if(elementos.item(1).onchange){elementos.item(1).onchange();}if(elementos.length==3){elementos.item(2).value=that.ano;if(elementos.item(2).onchange){elementos.item(2).onchange();}}else{that.div_form.getElementsByTagName("input").item(0).value=that.ano;}that.seletor.janela.fechar();that.div_form.getElementsByTagName("select").item(0).focus();};};this.set_mes_ano=function(){var hoje=new Date();var mes=hoje.getMonth();var ano=hoje.getFullYear();if(that.get(1)==0){that.mes=mes;}else{that.mes=that.get(1)-1;}if(that.get(2)==0){that.ano=ano;}else{that.ano=that.get(2);}that.min_ano=that.get_min_ano();that.max_ano=that.get_max_ano();};this.criar_caixa=function(pos){var janela=new class_janela();var caixa=janela.criar_janela("Selecione uma data",pos.x-200,pos.y-100,250,"auto");that.seletor.area_calendario=criar_elemento("div");caixa.appendChild(that.seletor.area_calendario);that.atualizar_calendario(that.mes,that.ano);that.seletor.janela=janela;};this.atualizar_calendario=function(){var dias_semana=["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"];var meses=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];var primeiro_dia=new Date(that.ano,that.mes,1);var ultimo_dia=new Date(that.ano,that.mes+1,0);var cal=criar_elemento("table",{"class":"calendario"},{"margin":"3px auto 5px auto"});{var thead=criar_elemento("thead");var tbody=criar_elemento("tbody");}cal.appendChild(thead);cal.appendChild(tbody);var linha=criar_elemento("tr");var th=criar_elemento("th");var a=criar_elemento("a",{"class":"seta"},{},"←");th.appendChild(a);linha.appendChild(th);th.onclick=function(){that.mes--;if(that.mes==-1){that.mes=11;if(that.ano>that.min_ano){that.ano--;}else{that.ano=that.max_ano;}}that.atualizar_calendario();};var th=criar_elemento("th",{"colspan":"5","class":"titulo_calendario"},{},meses[that.mes]+"/"+that.ano);linha.appendChild(th);var th=criar_elemento("th");var a=criar_elemento("a",{"class":"seta"},{},"→");th.appendChild(a);linha.appendChild(th);th.onclick=function(){that.mes++;if(that.mes==12){that.mes=0;if(that.ano<that.max_ano){that.ano++;}else{that.ano=that.min_ano;}}that.atualizar_calendario();};thead.appendChild(linha);linha=criar_elemento("tr");for(var i=0;i<7;i++){var th=criar_elemento("th",{},{"width":"2em"},dias_semana[i]);linha.appendChild(th);}thead.appendChild(linha);linha=criar_elemento("tr");for(var i=1;i<=primeiro_dia.getDay();i++){var td=criar_elemento("td");linha.appendChild(td);}for(var i=1;i<=7-primeiro_dia.getDay();i++){var td=criar_elemento("td",{},{},i);linha.appendChild(td);that.definir_dia(td,i);}tbody.appendChild(linha);while(i<=ultimo_dia.getDate()){var linha=criar_elemento("tr");for(var s=0;s<=6;s++){var td=criar_elemento("td");if(i<=ultimo_dia.getDate()){var texto=document.createTextNode(i);td.appendChild(texto);that.definir_dia(td,i);}linha.appendChild(td);i++;}tbody.appendChild(linha);}that.seletor.area_calendario.style.textAlign="center";that.seletor.area_calendario.style.border="1px solid #CCCCCC";limpar(that.seletor.area_calendario);that.seletor.area_calendario.appendChild(cal);var div_links=criar_elemento("div",{},{"fontSize":"small"},"Atalhos: ");var hoje=criar_elemento("a",{},{},"Hoje");hoje.onclick=function(){var hoje=new Date();var elementos=that.div_form.getElementsByTagName("select");elementos.item(0).value=hoje.getDate();if(elementos.item(0).onchange){elementos.item(0).onchange();}elementos.item(1).value=hoje.getMonth()+1;if(elementos.item(1).onchange){elementos.item(1).onchange();}if(elementos.length==3){elementos.item(2).value=hoje.getFullYear();if(elementos.item(2).onchange){elementos.item(2).onchange();}}else{that.div_form.getElementsByTagName("input").item(0).value=hoje.getFullYear();}that.seletor.janela.fechar();that.div_form.getElementsByTagName("select").item(0).focus();};div_links.appendChild(hoje);if(that.pode_vazio){var nenhum=criar_elemento("a",{},{},"Nenhum");nenhum.onclick=function(){var elementos=that.div_form.getElementsByTagName("select");elementos.item(0).value=0;if(elementos.item(0).onchange){elementos.item(0).onchange();}elementos.item(1).value=0;if(elementos.item(1).onchange){elementos.item(1).onchange();}if(elementos.length==3){elementos.item(2).value=0;if(elementos.item(2).onchange){elementos.item(2).onchange();}}else{that.div_form.getElementsByTagName("input").item(0).value=0;}that.seletor.janela.fechar();that.div_form.getElementsByTagName("select").item(0).focus();};div_links.appendChild(document.createTextNode(" | "));div_links.appendChild(nenhum);}that.seletor.area_calendario.appendChild(div_links);};this.abrir_calendario=function(e){that.set_mes_ano();if(that.seletor.janela==null){var pos=get_posicao_mouse(e);that.criar_caixa(pos);}else{that.atualizar_calendario();}that.seletor.janela.abrir(document.getElementsByTagName("body").item(0));};this.adicionar_link=function(){var incluir_estilo=true;var regex=new RegExp(/\/calendario.css$/);var l=document.childNodes.length;for(var i=0;i<l;i++){var c=document.childNodes.item(i);if(c.nodeType==7&&c.target.toLowerCase()=='xml-stylesheet'&&regex.test(c.data)){incluir_estilo=false;break;}}if(incluir_estilo){try{var estilo=document.createProcessingInstruction('xml-stylesheet','href="'+CFG.wwwroot+'layout/calendario.css" type="text/css" media="screen" charset="utf-8"');document.insertBefore(estilo,document.firstChild);}catch(e){var estilo=criar_elemento("link",{"rel":"stylesheet","type":"text/css","charset":"utf-8","media":"screen","href":CFG.wwwroot+"layout/calendario.css"});document.getElementsByTagName("head").item(0).appendChild(estilo);}}var s="Selecionar pelo Calendário";that.link=criar_elemento("img",{"src":CFG.wwwroot+"imgs/icones/calendario.gif","alt":s,"title":s},{"cursor":"pointer"});that.link.onclick=that.abrir_calendario;var antigo=that.div_form.getElementsByTagName("img");if(antigo.length>0){that.div_form.removeChild(antigo.item(0));}that.div_form.appendChild(that.link);that.pode_vazio=that.div_form.getElementsByTagName("select").item(0).getElementsByTagName("option").item(0).value==0;if(that.pode_vazio){var s="Nenhuma data";var anular=criar_elemento("img",{"src":CFG.wwwroot+"imgs/icones/cancelar.gif","alt":s,"title":s},{"cursor":"pointer","marginLeft":"5px"});anular.onclick=function(){var elementos=that.div_form.getElementsByTagName("select");elementos.item(0).value=0;if(elementos.item(0).onchange){elementos.item(0).onchange();}elementos.item(1).value=0;if(elementos.item(1).onchange){elementos.item(1).onchange();}if(elementos.length==3){elementos.item(2).value=0;if(elementos.item(2).onchange){elementos.item(2).onchange();}}else{that.div_form.getElementsByTagName("input").item(0).value=0;}};that.div_form.appendChild(anular);}};this.adicionar_link();}function class_popup(link){var that=this;this.id=class_popup.instancias.length;class_popup.instancias[this.id]=this;this.link=link;this.url=null;this.janela=null;this.area_conteudo=null;this.ajax=new class_ajax();this.criar_caixa=function(pos){var janela=new class_janela();var titulo=that.link.text.substr(0,40);if(titulo!=that.link.text){titulo=titulo+"...";}var caixa=janela.criar_janela(titulo,pos.x-450,pos.y-300,450,300);{that.area_conteudo=criar_elemento("div",{"class":"conteudo"});}caixa.appendChild(that.area_conteudo);that.janela=janela;};this.atualizar_conteudo=function(ajax){limpar(that.area_conteudo);var xml=ajax.get_retorno("xml");var div=xml.getElementById("conteudo_popup");div.style.width="auto";var filhos=div.getElementsByTagName("*");var l=filhos.length;for(var j=0;j<l;j++){filhos.item(j).style.width="auto";filhos.item(j).style.margin="0";}try{document.importNode(div,true);that.area_conteudo.appendChild(div);}catch(e){that.area_conteudo.innerHTML=div.innerHTML;}};this.carregar_conteudo=function(){var url=adicionar_param(that.url,"xml","1");that.ajax.set_callback([that,"atualizar_conteudo"]);that.ajax.exibir_carregando(that.area_conteudo);that.ajax.consultar("GET",url,true,null);};this.abrir_popup=function(e){if(that.janela==null){var pos=get_posicao_mouse(e);that.criar_caixa(pos);that.carregar_conteudo();}that.janela.abrir(document.getElementsByTagName("body").item(0));return false;};this.definir_link=function(){if((!that.ajax.xmlhttp)||(that.url!=null)){return;}that.url=that.link.getAttribute("href");that.link.onclick=that.abrir_popup;};this.definir_link();}